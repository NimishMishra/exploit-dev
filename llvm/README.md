# LLVM

## A very architecture

Code (high level) -> parser -> AST (data structure representation of the syntax of the code) -> machine code (generator)

LLVM is a component at the generator phase (wherein you seek to convert the AST to machine code). If LLVM is used, the AST generates the LLVM IR (intermediate representation). LLVM IR goes another stage (llc) that changes the intermediate representation into machine code. llc has an optimizer packaged in it (which is code optimization). 

At least on my PC, building LLVM takes on a large amount of swap space. A few options are added to restrict that `cmake -S llvm -B build -G "Unix Makefiles" -DCMAKE_INSTALL_PREFIX=/home/manwe/llvm -DLLVM_PARALLEL_LINK_JOBS=1 -DLLVM_LINK_LLVM_DYLIB=true -DLLVM_USE_LINKER=gold -DLLVM_USE_SPLIT_DWARF=ON`. Also, run all make files in parallel (I used 6 cores).

## TODO

- The grammar is way too simple and has conflicts. However, it is sufficient for our learning purpose. Other online resources speak a lot on making unambigous grammars. Best is to make an unambiguous CLR(1) grammar. Then Bison's LALR(1) will automatically be fine.

- Include function support (not that difficult to add).

## Directory structure

- **C_compiler_frontend**: A simple flex tokenizer coupled with bison parser.

Flex: v2.6.4
Bison: v3.7.3

- **C_compiler_AST**: A flex+bison AST generator for a simple C subset (suppors arithmetic, loops, and conditions)


## AST Output

**Sample Input** - `./C_compiler_AST/program.c`

**Truncated output** 

Blocks like `IF BLOCK`, `WHILE BLOCK` etc have more nodes under them, which are further broken down. The lowest unit displayed is `assignment node` or a relational operator node (`equality node` etc). There are further divisions under these that are internal to the parser I wrote.

```sh
--------------------------
Master block stored at: c4ae7280
Printing the AST nodes now: 
Master AST - 0x558fc4ae4630 (assignment node) 0x558fc4ae4800 (assignment node) 0x558fc4ae54a0 (IF BLOCK node) 0x558fc4ae56d0 (assignment node) 0x558fc4ae5810 (assignment node) 0x558fc4ae5d00 (IF BLOCK node) 0x558fc4ae5e00 (assignment node) 0x558fc4ae64c0 (FOR BLOCK node) 0x558fc4ae66a0 (assignment node) 0x558fc4ae68c0 (assignment node) 0x558fc4ae6c40 (WHILE BLOCK node) 0x558fc4ae6dd0 (assignment node) 0x558fc4ae6f60 (assignment node) 0x558fc4ae71c0 (DO WHILE BLOCK node) 

[IF BLOCK BREAKDOWN] 0x558fc4ae48f0 (less than node) 0x558fc4ae4a70 (assignment node) 0x558fc4ae4c70 (assignment node) 0x558fc4ae50c0 (IF BLOCK node) 0x558fc4ae5230 (assignment node) 0x558fc4ae53b0 (assignment node) 
[IF BLOCK BREAKDOWN] 0x558fc4ae58e0 (less than node) 0x558fc4ae5a40 (assignment node) 0x558fc4ae5ba0 (assignment node) 
[FOR BREAKDOWN] 0x558fc4ae6140 (less than node) 0x558fc4ae5f90 (assignment node) 0x558fc4ae60c0 (assignment node) 0x558fc4ae6250 (assignment node) 0x558fc4ae63f0 (assignment node) 
[WHILE BLOCK BREAKDOWN] 0x558fc4ae69d0 (less than node) 0x558fc4ae6a90 (assignment node) 0x558fc4ae6be0 (assignment node) 
[DO WHILE BLOCK BREAKDOWN] 0x558fc4ae7180 (equality node) 0x558fc4ae7070 (assignment node) 
------------------------- SYMBOL TABLE------------------------
Symbol 		 Memory
ax		0x558fc4ae4140
bx		0x558fc4ae4720
c		0x558fc4ae4950
y		0x558fc4ae4b60
s		0x558fc4ae55c0
l		0x558fc4ae5780
x		0x558fc4ae5ed0
g		0x558fc4ae6610
k		0x558fc4ae6770
n		0x558fc4ae6d10
m		0x558fc4ae6ea0

```

## Detailed Outputs


**Detailed Output of AST**

(Including a lot of debugging information. Useful for tracking as the AST grows)

```sh
parser.y: warning: 643 shift/reduce conflicts [-Wconflicts-sr]
parser.y: warning: 221 reduce/reduce conflicts [-Wconflicts-rr]
parser.y: note: rerun with option '-Wcounterexamples' to generate conflict counterexamples
[NODE] Identifier node created at 0x558fc4ae4140 with value ax
[DEBUG] Identifier: ax
[NODE] INTEGER node created at 0x558fc4ae45f0 with value 3
[DEBUG] Value: 3
[NODE] ASSIGNMENT node created at 0x558fc4ae4630. lvalue is located at 0x558fc4ae4140. rvalue is located at 0x558fc4ae45f0
[DEBUG] Assignment
[NODE] Identifier node created at 0x558fc4ae4720 with value bx
[DEBUG] Identifier: bx
[NODE] INTEGER node created at 0x558fc4ae47c0 with value 5
[DEBUG] Value: 5
[NODE] ASSIGNMENT node created at 0x558fc4ae4800. lvalue is located at 0x558fc4ae4720. rvalue is located at 0x558fc4ae47c0
[DEBUG] Assignment
[DEBUG] Identifier: ax
[DEBUG] Identifier: bx
[NODE] LESS THAN node created at 0x558fc4ae48f0. lhs is at 0x558fc4ae4140. rhs is at 0x558fc4ae4720
[DEBUG] LESS THAN
[NODE] Identifier node created at 0x558fc4ae4950 with value c
[DEBUG] Identifier: c
[DEBUG] Identifier: ax
[DEBUG] Identifier: bx
[NODE] ADD node created at 0x558fc4ae4a20. LHS is at 0x558fc4ae4140. RHS is at 0x558fc4ae4720
[DEBUG] ADD 
[NODE] ASSIGNMENT node created at 0x558fc4ae4a70. lvalue is located at 0x558fc4ae4950. rvalue is located at 0x558fc4ae4a20
[DEBUG] Assignment
[NODE] Identifier node created at 0x558fc4ae4b60 with value y
[DEBUG] Identifier: y
[DEBUG] Identifier: ax
[DEBUG] Identifier: bx
[NODE] DIVIDE node created at 0x558fc4ae4c20. LHS is at 0x558fc4ae4140. RHS is at 0x558fc4ae4720
[DEBUG] DIVIDE 
[NODE] ASSIGNMENT node created at 0x558fc4ae4c70. lvalue is located at 0x558fc4ae4b60. rvalue is located at 0x558fc4ae4c20
[DEBUG] Assignment
[DEBUG] Identifier: y
[DEBUG] Identifier: c
[NODE] LESS THAN node created at 0x558fc4ae4d80. lhs is at 0x558fc4ae4b60. rhs is at 0x558fc4ae4950
[DEBUG] LESS THAN
[DEBUG] Identifier: y
[DEBUG] Identifier: y
[DEBUG] Identifier: c
[NODE] SUB node created at 0x558fc4ae4e20. LHS is at 0x558fc4ae4b60. RHS is at 0x558fc4ae4950
[DEBUG] SUB 
[NODE] ASSIGNMENT node created at 0x558fc4ae4e70. lvalue is located at 0x558fc4ae4b60. rvalue is located at 0x558fc4ae4e20
[DEBUG] Assignment
[DEBUG] Identifier: y
[DEBUG] Identifier: y
[DEBUG] Identifier: c
[NODE] ADD node created at 0x558fc4ae4fa0. LHS is at 0x558fc4ae4b60. RHS is at 0x558fc4ae4950
[DEBUG] ADD 
[NODE] ASSIGNMENT node created at 0x558fc4ae4ff0. lvalue is located at 0x558fc4ae4b60. rvalue is located at 0x558fc4ae4fa0
[DEBUG] Assignment
[BLOCK] IF BLOCK created at 0x558fc4ae50c0. condition at 0x558fc4ae4d80. if statements block at 0x558fc4ae4eb0. else statements block at 0x558fc4ae5030
0x558fc4ae4d80 (less than node) 0x558fc4ae4e70 (assignment node) 0x558fc4ae4ff0 (assignment node) [DEBUG] Identifier: y
[DEBUG] Identifier: ax
[DEBUG] Identifier: bx
[NODE] SUB node created at 0x558fc4ae51e0. LHS is at 0x558fc4ae4140. RHS is at 0x558fc4ae4720
[DEBUG] SUB 
[NODE] ASSIGNMENT node created at 0x558fc4ae5230. lvalue is located at 0x558fc4ae4b60. rvalue is located at 0x558fc4ae51e0
[DEBUG] Assignment
[DEBUG] Identifier: c
[DEBUG] Identifier: ax
[DEBUG] Identifier: bx
[NODE] MULTIPLY node created at 0x558fc4ae5360. LHS is at 0x558fc4ae4140. RHS is at 0x558fc4ae4720
[DEBUG] MUL 
[NODE] ASSIGNMENT node created at 0x558fc4ae53b0. lvalue is located at 0x558fc4ae4950. rvalue is located at 0x558fc4ae5360
[DEBUG] Assignment
[BLOCK] IF BLOCK created at 0x558fc4ae54a0. condition at 0x558fc4ae48f0. if statements block at 0x558fc4ae4cd0. else statements block at 0x558fc4ae5410
[NODE] Identifier node created at 0x558fc4ae55c0 with value s
[DEBUG] Identifier: s
[NODE] REAL node created at 0x558fc4ae5690 with value 350
[DEBUG] Value: 350.000000
[NODE] ASSIGNMENT node created at 0x558fc4ae56d0. lvalue is located at 0x558fc4ae55c0. rvalue is located at 0x558fc4ae5690
[DEBUG] Assignment
[NODE] Identifier node created at 0x558fc4ae5780 with value l
[DEBUG] Identifier: l
[NODE] REAL node created at 0x558fc4ae57d0 with value 12
[DEBUG] Value: 12.000000
[NODE] ASSIGNMENT node created at 0x558fc4ae5810. lvalue is located at 0x558fc4ae5780. rvalue is located at 0x558fc4ae57d0
[DEBUG] Assignment
[DEBUG] Identifier: s
[DEBUG] Identifier: l
[NODE] LESS THAN node created at 0x558fc4ae58e0. lhs is at 0x558fc4ae5780. rhs is at 0x558fc4ae55c0
[DEBUG] LESS THAN
[DEBUG] Identifier: s
[DEBUG] Identifier: s
[DEBUG] Identifier: l
[DEBUG] Identifier: s
[NODE] ADD node created at 0x558fc4ae59a0. LHS is at 0x558fc4ae5780. RHS is at 0x558fc4ae55c0
[DEBUG] ADD 
[NODE] MULTIPLY node created at 0x558fc4ae59f0. LHS is at 0x558fc4ae55c0. RHS is at 0x558fc4ae59a0
[DEBUG] MUL 
[NODE] ASSIGNMENT node created at 0x558fc4ae5a40. lvalue is located at 0x558fc4ae55c0. rvalue is located at 0x558fc4ae59f0
[DEBUG] Assignment
[DEBUG] Identifier: s
[DEBUG] Identifier: s
[DEBUG] Identifier: l
[DEBUG] Identifier: s
[NODE] SUB node created at 0x558fc4ae5b00. LHS is at 0x558fc4ae5780. RHS is at 0x558fc4ae55c0
[DEBUG] SUB 
[NODE] MULTIPLY node created at 0x558fc4ae5b50. LHS is at 0x558fc4ae55c0. RHS is at 0x558fc4ae5b00
[DEBUG] MUL 
[NODE] ASSIGNMENT node created at 0x558fc4ae5ba0. lvalue is located at 0x558fc4ae55c0. rvalue is located at 0x558fc4ae5b50
[DEBUG] Assignment
[BLOCK] IF BLOCK created at 0x558fc4ae5d00. condition at 0x558fc4ae58e0. if statements block at 0x558fc4ae5be0. else statements block at 0x558fc4ae5c70
[DEBUG] Identifier: ax
[NODE] INTEGER node created at 0x558fc4ae5dc0 with value 0
[DEBUG] Value: 0
[NODE] ASSIGNMENT node created at 0x558fc4ae5e00. lvalue is located at 0x558fc4ae4140. rvalue is located at 0x558fc4ae5dc0
[DEBUG] Assignment
[NODE] Identifier node created at 0x558fc4ae5ed0 with value x
[DEBUG] Identifier: x
[NODE] INTEGER node created at 0x558fc4ae5f50 with value 0
[DEBUG] Value: 0
[NODE] ASSIGNMENT node created at 0x558fc4ae5f90. lvalue is located at 0x558fc4ae5ed0. rvalue is located at 0x558fc4ae5f50
[DEBUG] Assignment
[DEBUG] Identifier: s
[NODE] INTEGER node created at 0x558fc4ae6080 with value 10
[DEBUG] Value: 10
[NODE] ASSIGNMENT node created at 0x558fc4ae60c0. lvalue is located at 0x558fc4ae55c0. rvalue is located at 0x558fc4ae6080
[DEBUG] Assignment
[DEBUG] Identifier: x
[DEBUG] Identifier: s
[NODE] LESS THAN node created at 0x558fc4ae6140. lhs is at 0x558fc4ae5ed0. rhs is at 0x558fc4ae55c0
[DEBUG] LESS THAN
[DEBUG] Identifier: x
[DEBUG] Identifier: x
[NODE] INTEGER node created at 0x558fc4ae61c0 with value 1
[DEBUG] Value: 1
[NODE] ADD node created at 0x558fc4ae6200. LHS is at 0x558fc4ae5ed0. RHS is at 0x558fc4ae61c0
[DEBUG] ADD 
[NODE] ASSIGNMENT node created at 0x558fc4ae6250. lvalue is located at 0x558fc4ae5ed0. rvalue is located at 0x558fc4ae6200
[DEBUG] Assignment
[DEBUG] Identifier: ax
[DEBUG] Identifier: ax
[NODE] INTEGER node created at 0x558fc4ae6360 with value 4
[DEBUG] Value: 4
[NODE] ADD node created at 0x558fc4ae63a0. LHS is at 0x558fc4ae4140. RHS is at 0x558fc4ae6360
[DEBUG] ADD 
[NODE] ASSIGNMENT node created at 0x558fc4ae63f0. lvalue is located at 0x558fc4ae4140. rvalue is located at 0x558fc4ae63a0
[DEBUG] Assignment
[BLOCK] FOR block created at 0x558fc4ae64c0. condition at 0x558fc4ae6140. assign statements at 0x558fc4ae5fd0. update statements at 0x558fc4ae6290. for statement list at 0x558fc4ae6430
[NODE] Identifier node created at 0x558fc4ae6610 with value g
[DEBUG] Identifier: g
[NODE] INTEGER node created at 0x558fc4ae6660 with value 10
[DEBUG] Value: 10
[NODE] ASSIGNMENT node created at 0x558fc4ae66a0. lvalue is located at 0x558fc4ae6610. rvalue is located at 0x558fc4ae6660
[DEBUG] Assignment
[NODE] Identifier node created at 0x558fc4ae6770 with value k
[DEBUG] Identifier: k
[NODE] INTEGER node created at 0x558fc4ae6880 with value 200
[DEBUG] Value: 200
[NODE] ASSIGNMENT node created at 0x558fc4ae68c0. lvalue is located at 0x558fc4ae6770. rvalue is located at 0x558fc4ae6880
[DEBUG] Assignment
[DEBUG] Identifier: g
[DEBUG] Identifier: k
[NODE] LESS THAN node created at 0x558fc4ae69d0. lhs is at 0x558fc4ae6610. rhs is at 0x558fc4ae6770
[DEBUG] LESS THAN
[DEBUG] Identifier: g
[DEBUG] Identifier: g
[NODE] INTEGER node created at 0x558fc4ae6a50 with value 10
[DEBUG] Value: 10
[NODE] ADD node created at 0x558fc4ae5870. LHS is at 0x558fc4ae6610. RHS is at 0x558fc4ae6a50
[DEBUG] ADD 
[NODE] ASSIGNMENT node created at 0x558fc4ae6a90. lvalue is located at 0x558fc4ae6610. rvalue is located at 0x558fc4ae5870
[DEBUG] Assignment
[DEBUG] Identifier: k
[DEBUG] Identifier: k
[NODE] INTEGER node created at 0x558fc4ae6ba0 with value 4
[DEBUG] Value: 4
[NODE] DIVIDE node created at 0x558fc4ae5640. LHS is at 0x558fc4ae6770. RHS is at 0x558fc4ae6ba0
[DEBUG] DIVIDE 
[NODE] ASSIGNMENT node created at 0x558fc4ae6be0. lvalue is located at 0x558fc4ae6770. rvalue is located at 0x558fc4ae5640
[DEBUG] Assignment
[BLOCK] WHILE block created at 0x558fc4ae6c40. condition at 0x558fc4ae69d0. while statement list at 0x558fc4ae6ad0
[NODE] Identifier node created at 0x558fc4ae6d10 with value n
[DEBUG] Identifier: n
[NODE] REAL node created at 0x558fc4ae6d90 with value 5000
[DEBUG] Value: 5000.000000
[NODE] ASSIGNMENT node created at 0x558fc4ae6dd0. lvalue is located at 0x558fc4ae6d10. rvalue is located at 0x558fc4ae6d90
[DEBUG] Assignment
[NODE] Identifier node created at 0x558fc4ae6ea0 with value m
[DEBUG] Identifier: m
[NODE] REAL node created at 0x558fc4ae6f20 with value 6000
[DEBUG] Value: 6000.000000
[NODE] ASSIGNMENT node created at 0x558fc4ae6f60. lvalue is located at 0x558fc4ae6ea0. rvalue is located at 0x558fc4ae6f20
[DEBUG] Assignment
[DEBUG] Identifier: n
[DEBUG] Identifier: n
[NODE] INTEGER node created at 0x558fc4ae6fe0 with value 1
[DEBUG] Value: 1
[NODE] ADD node created at 0x558fc4ae7020. LHS is at 0x558fc4ae6d10. RHS is at 0x558fc4ae6fe0
[DEBUG] ADD 
[NODE] ASSIGNMENT node created at 0x558fc4ae7070. lvalue is located at 0x558fc4ae6d10. rvalue is located at 0x558fc4ae7020
[DEBUG] Assignment
[DEBUG] Identifier: n
[DEBUG] Identifier: m
[NODE] EQUALITY node created at 0x558fc4ae7180. lhs is 0x558fc4ae6d10. rhs is 0x558fc4ae6ea0
[DEBUG] EQUALITY
[BLOCK] WHILE block created at 0x558fc4ae71c0. condition at 0x558fc4ae7180. while statement list at 0x558fc4ae70b0
--------------------------
Master block stored at: c4ae7280
Printing the AST nodes now: 
Master AST - 0x558fc4ae4630 (assignment node) 0x558fc4ae4800 (assignment node) 0x558fc4ae54a0 (IF BLOCK node) 0x558fc4ae56d0 (assignment node) 0x558fc4ae5810 (assignment node) 0x558fc4ae5d00 (IF BLOCK node) 0x558fc4ae5e00 (assignment node) 0x558fc4ae64c0 (FOR BLOCK node) 0x558fc4ae66a0 (assignment node) 0x558fc4ae68c0 (assignment node) 0x558fc4ae6c40 (WHILE BLOCK node) 0x558fc4ae6dd0 (assignment node) 0x558fc4ae6f60 (assignment node) 0x558fc4ae71c0 (DO WHILE BLOCK node) 

[IF BLOCK BREAKDOWN] 0x558fc4ae48f0 (less than node) 0x558fc4ae4a70 (assignment node) 0x558fc4ae4c70 (assignment node) 0x558fc4ae50c0 (IF BLOCK node) 0x558fc4ae5230 (assignment node) 0x558fc4ae53b0 (assignment node) 
[IF BLOCK BREAKDOWN] 0x558fc4ae58e0 (less than node) 0x558fc4ae5a40 (assignment node) 0x558fc4ae5ba0 (assignment node) 
[FOR BREAKDOWN] 0x558fc4ae6140 (less than node) 0x558fc4ae5f90 (assignment node) 0x558fc4ae60c0 (assignment node) 0x558fc4ae6250 (assignment node) 0x558fc4ae63f0 (assignment node) 
[WHILE BLOCK BREAKDOWN] 0x558fc4ae69d0 (less than node) 0x558fc4ae6a90 (assignment node) 0x558fc4ae6be0 (assignment node) 
[DO WHILE BLOCK BREAKDOWN] 0x558fc4ae7180 (equality node) 0x558fc4ae7070 (assignment node) 
------------------------- SYMBOL TABLE------------------------
Symbol 		 Memory
ax		0x558fc4ae4140
bx		0x558fc4ae4720
c		0x558fc4ae4950
y		0x558fc4ae4b60
s		0x558fc4ae55c0
l		0x558fc4ae5780
x		0x558fc4ae5ed0
g		0x558fc4ae6610
k		0x558fc4ae6770
n		0x558fc4ae6d10
m		0x558fc4ae6ea0

```
