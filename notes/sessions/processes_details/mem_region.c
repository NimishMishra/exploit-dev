#include <unistd.h>
#include <sys/types.h>
#include <stdio.h>
#include <stdlib.h>

int a;
int b = 10;

void print_memory_region_addresses(int (*main_pointer)()){
    const char* read_only_data = "A constant string";
    int local_data;
    static int static_local_data;
    int* dynamic_data = (int*) malloc(1 * sizeof(int));

    printf("main() function address: %p. Distance from main: %ld\n", main_pointer,  (main_pointer - main_pointer));
    printf("Uninitialized global data address: %p. Distance from main: %ld\n", &a, (&a - (int*)main_pointer));
    printf("Initialized global data address: %p. Distance from main: %ld\n", &b, (&b - (int*)main_pointer));
    printf("Local constant data address: %p. Distance from main: %ld\n", read_only_data, ((int*)read_only_data - (int*)main_pointer));
    printf("Local data address: %p. Distance from main: %ld\n", &local_data, (&local_data - (int*)main_pointer));
    printf("Local static data address: %p. Distance from main: %ld\n", &static_local_data, (&static_local_data - (int*)main_pointer));
    printf("Dynamic data address: %p. Distance from main: %ld\n", dynamic_data, (dynamic_data  - (int*)main_pointer));
}

int main(){
    printf("All addresses are wrt main function address\n");
    if(fork() > 0){
        // This is in parent process
        printf("============= PARENT PROCESS ==================\n");
        print_memory_region_addresses(main);
    }
    else{
        // This is in child process
        printf("============= CHILD PROCESS ===================\n");
        print_memory_region_addresses(main);
    }
}
