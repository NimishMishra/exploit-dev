# Compilers

Stuff related to compilers

## Directory structure

- **llvm**: Building a foundation to integrate llvm with flex and bison

- **other_compiler_stuff**: Some old works and experiences in compilers

## Notes

### LLVM and Python Past, Present, Future

[Talk link](https://www.youtube.com/watch?v=C57HjehxBRc)

- Numba and llvmlite are making decent progress. llvmlite offers python bindings to LLVM backend, specificially the JIT execution engine.

- CPython execution workflow:

    - Tokens: read a file and tokenizes it

    - Concrete syntax tree or parsing (overlaps a lot)

    - Abstract syntax tree

    - Bytecode (and control flow graph like structures) code objects

    - Execution on CPython's virtual machine. 





### Flang : The Fortran frontend of LLVM 

This technical talk introduces the new Fortran fronted of LLVM.

[Talk link](https://www.youtube.com/watch?v=XiYAIzGCadc)

- Fortran is very popular in high performance computing and finds usage in the real world as in numerical simulation, weather forecasting.

- With flang, LLVM now has a frontend for Fortran. The old flang became the frontend for many corporate compilers, including AMD AOCC.

#### Stages of the flang compiler

- Preprocessing: normalises the source and outputs a cooked character stream

- Provenance: Maps the cooked character stream to the original source. Very useful in case of errors.

- Parsing: Recursive descent parsing. Uses the idea of parser combinators. 

![Example of F18 parsing](./images/1.png)

Note how the standard grammar rule is implemented. Note the optional portion of the grammar; contrast this with your actual grammar structure wherein you have different rules for different structures. Nothing is optional there.

- Semantic analysis: 
    
    - Check the grammar rules

    - Jump label resolution

    - Name resolution

    - Removes ambiguity in the parse tree

    - Constant expression evaluation

    - Expression and Statement semantic checks

    - Finally the module files are generated

Fortran dumps the modules as the fortran source itself. Have an example:

![How are modules treated?](./images/2.png)

- Optimizer: Uses MLIR (a framework for generating IR). Several optimisations happen before the Fortran IR is converted in LLVM IR. 
