# Jailbreaking

- Jailbreaking arises from the sandboxing solution relevant now-a-days.

- **A small history**: Early computers ran everything on hardware, implying that all processes were root essentially. Then came the split: Operating system (not affected by user) and userspace. But still, processes could starve each other and could clash shared memory. Then came virtual memory, which is hardware based solution to have different views for different processes. Then came *in-process* separation, which is the separation of the interpreter and the interpreter code (in scripting languages). 

- The basic motivation for sandboxing is that if everything is kept together, vulnerability with one leads to vulnerability in other. Sandboxing: untrusted code/data should live in a process with almost zero privileges, and all privileged stuff is requested from the parent. Sandboxing is very effective.

## chroot

- changes the meaning of `/` for a process and its children. It basically disallows processes to exit out of a jail.

```s
sudo chroot /tmp/jail /bin/bash
```
This means `/tmp/jail/bin/bash` which doesn't exist. So chroot disallows stuff outside the jail. You could have `busybox` inside the jail; busybox being statically linked is not cumbersome to set up in a jail.

- What `chroot` doesn't:
	- close resources that reside outside the jail
	- doesn't cd (chdir()) into the jail
	- do anything else

Unclosed resources problems: `execve` and `open` have variants `execveat()` and `openat()` that take in a resource (file descriptor of a directory) and everything shall be relative to that directory now.

- Kernel has no memory of previous chroots for a process. If you chroot again, that can help to escape. If the effective UID is 0, the user can always break out of the jail unless the chroot syscall itself is blocked.

- chroot is missing isolation in terms of IPC, networks, and PID. This means processes in the jail can talk to other stuff outside the jail, can use resources, and other stuff.

- Replacements: cgroups, seccomp, namespaces.
